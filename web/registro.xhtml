<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <f:view>
        <h:head>
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
            <title>CRV</title> 
             <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
            <script src="js/jquery.validate.min.js"></script>
            <script  src="js/index.js"></script>
            <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous"></link>
            <link rel="stylesheet" href="css/index.css"></link>
            <link rel="stylesheet" href="css/migasTitulo.css"></link>
            <script>
                 $(function () {//Ready

                    $.validator.addMethod('passwordMatch', function (value, element) {

                        var password = $('#altaUsuario\\:password').val();
                        var confirmPassword = $('#altaUsuario\\:passwordR').val();
                        if (password !== confirmPassword) {
                            return false;
                        } else {
                            return true;
                        }
                    }, "Your Password Must Match");




                    $.validator.addMethod('existNick', function (value, element) {

                        var datos = 'Nick=' + $("#altaUsuario\\:nick").val();
                        var response;
                        //Ponemos el nombre del servlet que nos dará la respuesta y los datos para poder encontrarlas
                        
                        $.ajax({
                                url: "CompruebaDatos",
                                dataType: 'json',
                                async: false,
                                data: datos,
                                success: function (result) {
                                    response = result.Nick;
                                    
                                   
                        }
                                });
                            
                               if (response) {
                                    return false;
                                        } else {
                                         return true;  
                                     }
                        

                    }, "Ya existe ese nick");
                    
                    $.validator.addMethod('existEmail', function (value, element) {

                        var datos = 'Email=' + $("#altaUsuario\\:correo").val();
                        var response;
                        //Ponemos el nombre del servlet que nos dará la respuesta y los datos para poder encontrarlas
                        
                        $.ajax({
                                url: "CompruebaDatos",
                                dataType: 'json',
                                async: false,
                                data: datos,
                                success: function (result) {
                                    response = result.Email;
                                    
                                   
                        }
                                });
                            
                               if (response) {
                                    return false;
                                        } else {
                                         return true;  
                                     }
                        

                    }, "Ya existe ese email");

                    $('#altaUsuario').validate({
                        rules: {
                            'altaUsuario:nick': {required: true, existNick: true},
                            'altaUsuario:correo': {required: true,email: true, existEmail: true},
                            'altaUsuario:password': {required: true},
                            'altaUsuario:passwordR': {required: true, passwordMatch: true}
                        },

                        messages: {

                            'altaUsuario:nick': {required: "El nick debe ser obligatorio.",existNick: "Ya existe ese nick"},
                            'altaUsuario:correo': {required: "El correo debe ser obligatorio.", email:"Debe tener el formato xxx@xx.xx",existEmail:"Ya tenemos ese email registrado"},
                            'altaUsuario:password': {required: "Contraseña obligatoria"},
                            'altaUsuario:passwordR': {required: "Repetir contraseña obligatorio",passwordMatch: "Las contraseñas deben ser iguales"}
                        }

                    });
                    
    });
                </script>
            
            
            <style>
                body{
                    background-color: #e1e1e1;
margin: 0;
                }
                #contenedorGeneral{
                width: 90%;
margin: 0 auto;
background-color: white;
margin-bottom: 3%;
overflow: hidden;
height: 1%;
clear: both;
                }
                #contenedorGeneral h1{
                    color: #ed2727;
                }
                #contenedorGeneral label{
                    font-size: 30px;
                }
                .izquierda{
                    width: 50%;

float: left;
                }
                .derecha{
                    width: 50%;
float: left;
                }
                label{
  display: inline-block;
  width: 45%;
}
label.error { float: none; color: red; padding-left: .5em; vertical-align: middle; font-size: 20px !important;
    width: 100% !important;
}
            </style>
        </h:head>
        <h:body>
            <h:panelGroup id="actualizarCabecera">
                <header>
                    <div id="logo">
                        <a href="index.xhtml"><img src="imagenes/Fotos/LogoIndex.png" alt="Inicio"></img></a>
                    </div>

                    <div id="idioma">
                        <p>Idioma</p>
                        <h:form>

                            <h:commandButton image="imagenes/Fotos/england.png"/>
                            <h:commandButton image="imagenes/Fotos/spain.png"/>
                        </h:form>
                    </div>

                    <div id="login">
                        <h:panelGroup id="actualizarRegistrarse" rendered="#{bLogin.comprobarRender(manageBeanSesion.logeado)}">

                            <div id="registroInicio">
                                <a href="registro.xhtml">Registrarse</a> 
                                <p> &#160;   || <span id="inicioSesion">Iniciar sesión</span></p>
                            </div>
                        </h:panelGroup>    
                    </div>            


                    <div id="contacto">
                        <img src="imagenes/Fotos/whatsapp.png" alt="Whatsapp"></img>
                        <p>628317327</p>
                    </div>

                    <div id="carrito">
                        <a href="/CRV/faces/cesta.xhtml" style="display:block; width: 100%; height:100%">
                            <p> <h:outputText value="#{bComprar.mens}"/></p>
                            <h:commandButton image="imagenes/Fotos/carrito.png"/>
                        </a>

                    </div>

                </header>
                <div id="menuHorizontal">
                    <ul>
                        <li><a href="index.xhtml" title="Home">Home</a></li>
                        <li><a href="/CRV/faces/comprar.xhtml" title="Comprar">Comprar</a></li>
                    </ul>

                    <h:panelGroup id="actualizarMenu" rendered="#{!bLogin.comprobarRender(manageBeanSesion.logeado)}">
                        <div id="contenedorDatosLogeado">

                            <div id="nombreUsuario">           
                                <p>Bienvenido, <h:outputText value="${manageBeanSesion.usuarioLog.nombre}"/></p>
                            </div>


                            <div id="cerrarSesion">           
                                <p><i class="fas fa-sign-out-alt"></i>
                                    <p:commandLink id="ajaxCerrarSesion" update="actualizarCabecera" action="#{manageBeanSesion.logout('/CRV/faces/index.xhtml')}" >
                                        <h:outputText value="Cerrar Sesión" />
                                    </p:commandLink></p>
                            </div>

                            <div id="accesoPerfil">           
                                <p>
                                    <i class="fas fa-user"></i><a href="/CRV/faces/usuario.xhtml" title="Usuario">Mi perfil</a></p>
                            </div>
                        </div> 
                    </h:panelGroup>
                </div>
            </h:panelGroup>

            <div id="modalInicioSesion" class="modal">
                <div id="inicioS" class='centrar'>
                    <span class="close"> <img src="imagenes/Fotos/cerrar.png" alt="Cerrar"></img></span>
                    <h:form id="formularioInicio">
                        <p><h:outputText value="Nick: "/> </p><h:inputText value="#{bLogin.nick}"/><br></br><br></br>
                        <p><h:outputText value="Contraseña: "/></p> <h:inputSecret value="#{bLogin.password}"/><br></br><br></br>
                        <p:commandButton value="Entrar" action="#{bLogin.compruebaLogin()}" update="formularioInicio actualizarMenu actualizarCabecera"/>
                        <br></br><br></br>
                        <h:outputText value="#{bLogin.mens}"/>
                    </h:form>
                </div>
            </div>
            
            <p:messages id="messages" showDetail="true" closable="true">
                <p:autoUpdate />
            </p:messages>
            
            <div id="contenedorBread">
                <nav id="migas">
                    <ul>
                        <li><a href="/CRV/faces/index.xhtml" title="Inicio">Inicio</a><i></i></li>
                        <li><em></em><a href="/CRV/faces/registro.xhtml" title="Registrarse">Registrarse</a><i></i></li>
                    </ul>
                </nav> 
            </div>

            <div  id="tituloPagina">
                <h1>Crear una cuenta</h1>
            </div>
            
            
            <div id="contenedorGeneral">
                <h:form id="altaUsuario">
                <div id="informacionPersonal">
                    <h1>Información Personal</h1>
                        <div class="izquierda">
                        <h:outputLabel for="nombre" value="Nombre: "/> 
                        <h:inputText id="nombre" value="#{bUsuarioGestionPersonal.nombreAlta}"/>
                       <br></br><br></br>
                         <h:outputLabel for="apelido1" value="Primer Apellido: "/> 
                        <h:inputText id="apelido1" value="#{bUsuarioGestionPersonal.ape1Alta}"/>
                        </div>
                        <div class="derecha">
                            <h:outputLabel for="correo" value="Email: "/> 
                        <h:inputText id="correo" value="#{bUsuarioGestionPersonal.emailAlta}"/>
                        <br></br><br></br>

                        <h:outputLabel for="apellido2" value="Segundo Apellido: "/> 
                        <h:inputText id="apellido2" value="#{bUsuarioGestionPersonal.ape2Alta}"/>
                        </div>
                   
                    
                </div>
                <div id="datosInicioSesion">
                    <h1>Datos de inicio de sesión</h1>
                         <div class="izquierda">
                        <h:outputLabel for="nick" value="Nick: "/> 
                        <h:inputText id="nick" value="#{bUsuarioGestionPersonal.nickAlta}"/>
                        <br></br><br></br>
                         <h:outputLabel for="passwordR" value="Repita contraseña: "/> 
                        <h:inputText id="passwordR" value="#{bUsuarioGestionPersonal.passwordRAlta}"/>
                        
                        
                        
                       
                       
                         </div>
                        <div class="derecha">
                          <h:outputLabel for="password" value="Contraseña: "/> 
                        <h:inputText id="password" value="#{bUsuarioGestionPersonal.passwordAlta}"/>   
                        <br></br><br></br>
                        <h:commandButton value="Modificar datos" action="#{bUsuarioGestionPersonal.altaUsuario()}" />
                        <br></br><br></br>
                        </div>
                </div>
                    </h:form>
            </div>        
        </h:body>
    </f:view>    
</html>
