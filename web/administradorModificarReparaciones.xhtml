<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <title>CRV</title>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script src="js/jquery.fancybox.min.js"></script>
        <link rel="stylesheet" href="css/jquery.fancybox.min.css"></link>
        <script>

            $(document).ready(function () {

                //Con el .on, podemos añadirle cualquier evento "keyup" , "keypress" , "keydown" en vez de poner .keyup , .keypress
                $("#myInput").on("keyup", function () {
                    //Aquí el $(this) significa esto: $("#myInput"), el valor de lo que escribimos en el input
                    var textoEscrito = $(this).val().toLowerCase();
                    $("#tablaR tbody tr").filter(function () {
                        //Hacemos esto para filtar por columnas

                        //Variable que guarda el contenido la celdas que contempla las columnas seleccionadas para filtrar
                        var textoCeldas = "";

                        //Variable que guarda #myTable tbody tr es decir la fila ya que al meternos en el each perderemos cambia el this
                        var fila = this;

                        //Cogemos los checkbox que estan checkeados, esto devuelve una lista, la recorremos
                        $(":checkbox:checked").each(function () {
                            //Guardamos el id de la columna que hemos seleccionado, con el attr accedemos al atributo indicado en este caso el id
                            //Que empieza en 0 así coincide el id con la posición de la columna	
                            var posicionColumna = $(this).val();
                            //Añadimos a la variable textoCeldas lo que contiene cada celda de la columna seleccionada
                            textoCeldas += fila.cells[posicionColumna].textContent;
                        })


                        //Cogemos el valor de la posicion de las letras, si no las encuentras es -1
                        var posicionEncontrado = textoCeldas.toLowerCase().indexOf(textoEscrito);

                        //Comprobamos que radio esta seleccionado si da verdadero sera el primero y lo ocultaremos si es falso lo pondrá en rojo

                        $(this).css("color", "black");
                        //Este metodo si se le pasa un parametro verdadero muestra el contenido(la deja como esta), si da falso la oculta
                        $(this).toggle(posicionEncontrado > -1)



                    });
                });

                //Si hacemos el click en un radio llamamos otra vez a la funcion del keyup que hemos programado
                $(":checkbox").click(function () {
                    $("#myInput").trigger("keyup");
                });

                //Si hacemos el click en un checkbox llamamos otra vez a la funcion del keyup que hemos programado
                $(":checkbox").click(function () {
                    $("#myInput").trigger("keyup");
                });

                //Mostrar imagen en grande
                $().fancybox({
                    selector: '[data-fancybox="showImg"]'
                });

            });//(ready



        </script>
    </h:head>
    <h:body>
        <p:messages id="messages" showDetail="true" closable="true">
            <p:autoUpdate />
        </p:messages>
        <h1><h:outputText value="Administrador"/></h1>
        <h1><h:outputText value="#{manageBeanSesion.administradorLog.nick}, Bienvenido a su perfil!"/></h1>

        <h:form id="tablaRO">

            <p:dataTable id="reparaciones" 
                         value="#{bAdministradorModificarReparacion.listaReparacionesTabla}" 
                         var="reparacion" 
                         rowKey="#{reparacion.codigoReparacion}"
                         editable="true"  
                         selection="#{bAdministradorModificarReparacion.miReparacion}" 
                         selectionMode="single">

                <p:column headerText="Codigo Reparacion">

                    <h:outputText value="#{reparacion.codigoReparacion}" />

                </p:column>

                <p:column headerText="Nombre Reparacion">
                    <h:outputText value="#{reparacion.nombre}" />

                </p:column>

            </p:dataTable>


            <p:contextMenu for="reparaciones">
                <p:menuitem value="Delete" update="tablaRO tablaR messages" icon="ui-icon-close" actionListener="#{bAdministradorModificarReparacion.bajaReparacion()}"/>
            </p:contextMenu>

        </h:form>

        <!--Elementos para filtrar la tabla-->
        <label><input type="checkbox" id="modelo" value="1"></input> Modelo teléfono</label><br></br>
        <label><input type="checkbox" id="marca" value="2"></input> Marca teléfono</label><br></br>
        <label><input type="checkbox" id="reparacion" value="3"></input> Tipo reparacion</label><br></br>

        <input id="myInput" type="text" placeholder="Search.."></input>

        <h:form id="tablaR">

            <p:dataTable id="reparacionesTelefono" 
                         value="#{bAdministradorModificarReparacion.listaReparacionesTelefonoTabla}" 
                         var="reparacionTelefono" 
                         rowKey="#{reparacionTelefono.codigoReparacionTelefono}"
                         editable="true"  
                         selection="#{bAdministradorModificarReparacion.miReparacionTelefono}" 
                         selectionMode="single"  
                         rows="5"
                         paginator="true"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowsPerPageTemplate="5,10,15" >

                <p:ajax event="rowEdit" listener="#{bAdministradorModificarReparacion.onRowEdit}" update="messages" />
                <p:ajax event="rowEditCancel" listener="#{bAdministradorModificarReparacion.onRowCancel}" update="messages" />

                <p:column headerText="Codigo Reparacion">

                    <h:outputText value="#{reparacionTelefono.codigoReparacionTelefono}" />

                </p:column>

                <p:column headerText="Nombre Telefono">
                    <h:outputText value="#{reparacionTelefono.codigoTelefono.nombre}" />

                </p:column>

                <p:column headerText="Marca Telefono">

                    <h:outputText value="#{reparacionTelefono.codigoTelefono.marca}" />

                </p:column>

                <p:column headerText="Nombre Reparación">
                    <h:outputText value="#{reparacionTelefono.codigoReparacion.nombre}" />
                </p:column>

                <p:column headerText="Precio">

                    <p:cellEditor>
                        <f:facet name="output"><h:outputText value="#{reparacionTelefono.precio}" /></f:facet>
                        <f:facet name="input"><p:inputText value="#{reparacionTelefono.precio}" style="width:100%" label="precio"/></f:facet>
                    </p:cellEditor>
                </p:column>


                <p:column style="width:32px">
                    <p:rowEditor />
                </p:column>

            </p:dataTable>


            <p:contextMenu for="reparacionesTelefono">
                <p:menuitem value="Delete" update="tablaR messages" icon="ui-icon-close" actionListener="#{bAdministradorModificarReparacion.bajaReparacionTelefono()}"/>
            </p:contextMenu>

        </h:form>

        <!--Añadir reparacion-->
        <div style="border: 1px solid red">
            <h1> Dar alta reparacion </h1>
            <h:form id="altaReparacion">
                <h:outputLabel for="nombre" value="Nombre: "/> 
                <p:inputText id="nombre" value="#{bAdministradorModificarReparacion.nombre}" required="true"/>
                <p:message for="nombre" />
                <br></br><br></br>

                <p:commandButton value="Añadir Reparacion" validateClient="true" action="#{bAdministradorModificarReparacion.altaReparacion()}" update="tablaRO altaReparacion messages"/>
                <br></br><br></br>
            </h:form>
        </div>

        <!--Añadir reparaciones a un telefono-->
        <div style="border: 1px solid orange">
            <h1> Dar alta reparacion a un telefono </h1>
            <h:form id="altaReparacionTelefono">
                <h:outputLabel for="marca" value="Seleccione una marca: "/>
                <h:selectOneMenu id="marca" value="#{bAdministradorModificarReparacion.marca}">
                    <f:selectItem itemLabel="Selecione una " itemValue="" />
                    <f:selectItems value="#{bAdministradorModificarReparacion.listaMarcas}"/>
                    <p:ajax event="change" update="modelo"
                            listener="#{bAdministradorModificarReparacion.consultarModelos}" />
                </h:selectOneMenu>

                <h:outputLabel for="modelo" value="Seleccione un modelo de la marca: "/>
                <h:selectOneMenu id="modelo" value="#{bAdministradorModificarReparacion.codigoTelefono}">
                    <f:selectItem itemLabel="Selecione uno " itemValue="" />
                    <f:selectItems value="#{bAdministradorModificarReparacion.listaModelos}"/>
                    <p:ajax event="change" update="reparacion"
                            listener="#{bAdministradorModificarReparacion.consultarReparacionesDisponibles}" />
                </h:selectOneMenu>
                <br></br><br></br>

                <h:outputLabel for="reparacion" value="Seleccione una reparacion "/>
                <h:selectOneMenu id="reparacion" value="#{bAdministradorModificarReparacion.codigoReparacion}">
                    <f:selectItem itemLabel="Selecione uno " itemValue="" />
                    <f:selectItems value="#{bAdministradorModificarReparacion.listaReparaciones}"/>
                </h:selectOneMenu>

                <h:outputLabel for="precio" value="Precio: "/>
                <p:inputText id="precio" value="#{bAdministradorModificarReparacion.precio}" required="true" validatorMessage="Debe ser un número decimal(con punto) entre 0.00 y 9999.99">
                    <f:validateRegex pattern="^\d{1,4}(\.\d{1,2})?$" />
                </p:inputText>
                <p:message for="precio" />

                <h:commandButton value="Añadir reparacion de telefono" action="#{bAdministradorModificarReparacion.altaReparacionTelefono()}"/>
                <br></br><br></br>
            </h:form>
        </div>


    </h:body>     
</html>
